# Template file for 'pgadmin4'
pkgname=pgadmin4
version=4.26
revision=1
wrksrc="pgadmin4-${version}"
hostmakedepends="qt5-qmake python3-devel qt5-host-tools qt5-devel"
depends="python3-Flask python3-Flask-Login python3-Flask-Mail
 python3-blinker python3-Flask-Paranoid python3-Flask-Security-Too python3-Flask-Principal
 python3-passlib python3-Flask-WTF python3-speaklater python3-Flask-SQLAlchemy python3-simplejson python3-dateutil
 python3-Flask-Migrate python3-alembic python3-psycopg2 python3-cryptography python3-sshtunnel python3-ldap3
 python3-Flask-Gravatar python3-sqlparse python3-psutil python3-Flask-Compress"
short_desc="Comprehensive design and management interface for PostgreSQL"
maintainer="mustaqim <git@mustaqim.ml>"
license="PostgreSQL"
homepage="http://www.pgadmin.org"
distfiles="https://ftp.postgresql.org/pub/pgadmin/pgadmin4/v${version}/source/pgadmin4-${version}.tar.gz"
checksum=46b69668941c80da763b869b7dc6723ad502443d68e8012b7fccd3c99569475d
patch_args="-Np1"

do_configure() {
	vsed -i runtime/ConfigWindow.ui \
		-e 's|/usr/pgadmin4/web|/usr/lib/pgadmin4/web|'
}

do_build() {
	export PGADMIN_PYTHON_DIR=/usr
	cd runtime
	qmake CONFIG+=release
	make
}

do_install() {
	vbin runtime/pgAdmin4
	vmkdir /usr/lib/pgadmin4
	vcopy web /usr/lib/pgadmin4
}

post_install() {
	vinstall "${FILESDIR}/pgadmin4.desktop" 644 usr/share/applications/
	vinstall runtime/pgAdmin4.png 644 usr/share/icons/
	vlicense LICENSE
}
